

## Информация о проекте
GoodWareMixApi - это серверное приложение для **автоматизированного сбора** информации выпускаемой/продаваемой продукции с сервисов/серверов поставщиков в различных форматах, основные из которых являются:
- [JSON](#json);
- [XML](#xml);
- [XLSX](#xlsx).

Программный продукт был разработан в рамках производственной практики.

## Инструменты для разработки и особенности Scheduler'a

При разработке использовались следующие инструменты:

- Серверное приложение разработано на платформе **.NET 6**;
- При разработке использовалась **IDE Microsoft Visual Studio 2022**;
- Документоориентированная СУБД **MongoDB**.


В данном проекте можно создавать задачи с помощью встроенного Scheduler'a (Используется технология **QUARTZ .NET**). Задача по автоматическому сбору информации также будет запускаться при старте сервера. Данная технология использует [Cron-выражения](#goToCron), с руководством можете ознакомиться по ссылке.




# Инструкция по использованию приложения

Ниже представлено подробное руководство по эксплуатации приложения
## Перед запуском автоматизированного сбора
1. Создать базу данных с названием: **WebApiDatabase**;

2. Вам необходимо добавить поставщиков в соответсвие с правилами заполнения данных представленных в руководствах ниже;
3. Запустить задачу и ждать сбора данных с сервера поставщика.

В приложение есть Logger, который позволяет отслеживать состояние сбора данных на сервере

## Руководство использования Cron выражений
<a id="goToCron"></a>

Cron (Command Run On) - это система для автоматического запуска задач в определенное время.

Cron-выражения предназначены для возможности задавать периодичность и время срабатывания задач планировщика.

### Синтаксис cron-выражений

Период срабатывания определенной задачи задается посредством синтаксиса cron-выражений.

Cron-выражение - это строка, состоящая из 6 или 7 полей, отделенных между собой пробелами, где Seconds, Minutes, Day of month и др. - это хронологический параметр; YES - указание обязательности использования данного фрагмента cron-выражения; 0-59 - значение, допустимый интервал для заданного элемента cron-выражения; (* /- ,) - набор разрешенных спецсимволов.

Поля могут содержать любые из допустимых значений, а также различные комбинации специальных символов.

Примечание: подробную информацию о специальных символах смотрите в разделе контекстной справки Специальные символы.

Формат cron-выражения выглядит следующим образом:


| Имя         | Обязательно | Значение        | Разрешенные специальные символы |
|-------------|-------------|-----------------|---------------------------------|
| Секунды     | Да          | 0-59            | `,` `-` `*` `/` `R`             |
| Минуты      | Да          | 0-59            | `,` `-` `*` `/` `R`             |
| Часы        | Да          | 0-23            | `,` `-` `*` `/` `R`             |
| День месяца | Да          | 1-31            | `,` `-` `*` `/` `?` `L` `W`     |
| Месяц       | Да          | 1-2 или JAN-DEC | `,` `-` `*` `/`                 |
| День недели | Да          | 0–6 или SUN-SAT | `,` `-` `/` `?` `L` `#`         |
| Год         | Да          | 1970-2099       | `,` `-` `*` `/`                 |


### Специальные символы

В cron-выражениях используются следующие специальные символы:

* `*` - все значения в пределах одного фрагмента cron-выражения. Например, в поле "Minutes" специальный символ "*" обозначает, что задача будет выполняться каждую минуту;
* `?` - неопределенное значение. Если Вам необходимо, чтобы задача запускалась, к примеру 10 числа каждого месяца, но не важно, в какой день недели, то в поле "Day of month" необходимо установить значение "10", а в поле "Day of week" - "?";
* `-` - определение диапазонов. Например, "10-12" в поле "Hours" означает часы 10, 11 и 12;
* `,` - указание дополнительных значений. К примеру, значения "ПОНЕДЕЛЬНИК, СРЕДА, ПЯТНИЦА" в поле "Day of week" будут использоваться в cron-выражении в виде запуска задачи в понедельник, среду и пятницу;
* `/` - приращение значений. Например, "5/15" в области секунд означает "секунды 5, 20, 35, и 50, то есть значение "5" будет увеличиваться на "15";
* `L` - определение последнего дня. В поле "Day of month", к примеру, значение "L" подразумевает, что задача будет выполняться в последний день каждого месяца. В поле "Month" значение "6L" обозначает, что задача была запущена в прошлую пятницу месяца;
* `W` - определение буднего дня (понедельник-пятница). Например, в поле "Day of month" значение "15 W" будет обозначать самый близкий будний день к 15-ому из месяца, то есть если 15-м числом является суббота, задача будет запущена в пятницу 14-го. Если 15-ым числом будет воскресенье, то задача будет запущена в понедельник 16-го.

### Примеры cron-выражений
Реальные примеры, иллюстрирующие некоторые разновидности CRON-выражения.
| CRON-Выражение        | Описание                                                                          |
|-----------------------|-----------------------------------------------------------------------------------|
| `0 0 12 * * ? *`      | Срабатывание в 12:00 (полдень) каждый день.                                       |
| `0 15 10 * * ? 2016`  | Срабатывание в 10:15 каждый день в течение всего 2016 года.                       |
| `0 * 14 * * ? *`      | Срабатывание каждую минуту с 14:00 до 14:59 каждый день.                          |
| `0 0/5 14 * * ? *`    | Срабатывание каждые 5 минут с 14:00 до 14:55 каждый день.                         |
| `0 0/5 14,18 * * ? *` | Срабатывание каждые 5 минут с 14:00 до 14:55, а также каждые 5 минут с 18:00 до 18:55 каждый день. |
| `0 10,44 14 ? 3 WED *`| Срабатывание в 14:10 и 14:44 каждую среду марта.                                  |
|`0 15 10 ? * MON-FRI *`| Срабатывание в 10:15 по будням (в понедельник, вторник, среду, четверг и пятницу).|
|`0 15 10 15 * ? *`     | Срабатывание в 10:15, 15 числа каждого месяца.                                    |
|`0 15 10 ? * 5L *`     | Срабатывание в 10:15 в последнюю пятницу каждого месяца.                          |
|`0 15 10 ? * 5L 2016-2020` | Срабатывание в 10:15 в последнюю пятницу каждого месяца с 2016 по 2020 гг. включительно.  |
|`0 15 10 ? * 5#3 *`    | Срабатывание в 10:15 в 3-ю пятницу каждого месяца.                                |
|`0 0 * * * ? *`        | Срабатывание ежечасно, ежедневно.                                                 |

## Руководство для импорта файла типа «EXCEL»
<a id="xlsx"></a>
Файл представляет собой структуру записей типа:

| Название | Столбец 1 |.. | Столбец 10 |
| :--------:| :-------:| :--:| :-------:|
| Значение 1| Значение | ... | Значение |
| Значение 2| Значение | ... | Значение |

 -- Для начала импорта пользователь должен заполнить все необходимые поля. Обязательные поля помечены ```*```
#### Подключение
- Url - Требуется ввести ссылку на файл импорта либо указать API поставщика вместе с ключом (API Key) если принимает через Query параметр.
- Тип запроса - В выпадающем списке требуется выбрать тип запроса на сервер поставщика (В большинстве случаев GET).
- Тип файла - В выпадающем списке требуется выбрать тип файла для импорта.
- Кодировка файла - Если в файле для импорта указана другая кодировка (например windows 1251) пользователь должен указать её в поле.
- Стартовая страница - Поле для поставщиков у которых API позволяет получать список товаров постранично, нужно указать первую страницу с API поставщика.
- Кол-во записей на странице - Количество товаров выдаваемое поставщиком на одной странице API.
- Header запроса - Требуется ввести список параметров запроса.  (Например ```Authorization:Bearer Token```).
Структура: ```[{"HeaderName":"...","HeaderValue":"..."}, {...}]``` где ```...``` требуется указать Имя и Значение в соответствии с документацией поставщика.
- Body запроса - Тело запроса если используется ```POST``` запрос.
Структура: ```{"token":"..."}``` где ```...``` требуется указать API-Key в соответствии с документацией поставщика.

#### Сопоставление по коду поставщика
- Вендор ID* - Требуется ввести название поля связанного с внутренним артикулом товара (```Штрихкод, артикль```).
- Проверка Вендор ID - Здесь можно найти префикс поставщика по значению артикля. Если проверка прошла успешно, ```"Префикс"``` автоматически заполнится.
- Префикс - Префикс заданный при импорте нуменклатуры в учётной системе. 

#### Товар
- Основной каталог* - Номер строки в которой находятся заголовки столбцов. (```0```, ```1 ```)
- Название* - Имя колонки хранящей название. (например ```Номенклатура```).
- Полное Название - Имя колонки хранящей полное название. (например ```Полное название```).
- Описание - Имя колонки хранящей описание. (например ```Oписание```).
- Вендор - Имя тега хранящий название вендора. (например ```vendor```).
- Фото - Имя тега хранящий ссылку на фото. (например ```Картинка```, ```Картинка 1```).
Если требуется взять массив фото то нужно указать названия столбцов с нужными значениями
(например ```Картинка1;Картинка2```). 
- Фото 360 - Имя тега хранящий ссылку на фото. (например ```Картинка 360```).
- Видео - Имя тега хранящий ссылку на видео. (например ```Видео```).
- Особенности - Имя тега хранящий список особенностей. (например ```Особенности```).

#### Аттрибуты
 - Заполнение этого раздела не требуется.

#### Примеры
- Если нужно выбрать несколько столбцов для заполнения. 

    Пример для фото - ```Картинка 1;Картинка 2; ... Картинка 8;Картинка 9```
    | Картинка 1                | Картинка 2                | ... | Картинка 8                | Картинка 9 |
    | :-----------------------: | :-----------------------: | :-: | :-----------------------: | :-: |
    | https:/site.ru/image1.png | https:/site.ru/image2.png | ... | https:/site.ru/image8.png | https:/site.ru/image9.png | 
    
 
- Для того чтобы получить список аттрибутов следуюет воспользоваться вкладкой "Словарь" для сопоставления названий колонок с аттрибутами из базы данных, напимер:
    | Поставщик     | База данных | 
    | :-----------: |  :--------: |
    | Основной цвет |  Цвет       |



## Руководство для импорта файла типа «JSON»
<a id="json"></a>
Файл представляет собой структуру записей типа:
```json
{
    "one": 2,
    "three": {
        "point_1": "point_2",
        "point_3": 3.4
    },
    "list": [
        "one",
        "two",
        "three"
    ]
}
```
Для начала импорта пользователь должен заполнить все необходимые поля. Обязательные поля помечены ```*```
#### Подключение
- Url - Требуется ввести ссылку на файл импорта либо указать API поставщика вместе с ключом (API Key) если принимает через Query параметр.
- Тип запроса - В выпадающем списке требуется выбрать тип запроса на сервер поставщика (В большинстве случаев GET).
- Тип файла - В выпадающем списке требуется выбрать тип файла для импорта.
- Кодировка файла - Если в файле для импорта указана другая кодировка (например windows 1251) пользователь должен указать её в поле.
- Стартовая страница - Поле для поставщиков у которых API позволяет получать список товаров постранично, нужно указать первую страницу с API поставщика.
- Кол-во записей на странице - Количество товаров выдаваемое поставщиком на одной странице API.
- Header запроса - Требуется ввести список параметров запроса.  (Например ```Authorization:Bearer Token```).
Структура: ```[{"HeaderName":"...","HeaderValue":"..."}, {...}]``` где ```...``` требуется указать Имя и Значение в соответствии с документацией поставщика.
- Body запроса - Тело запроса если используется ```POST``` запрос.
Структура: ```{"token":"..."}``` где ```...``` требуется указать API-Key в соответствии с документацией поставщика.

#### Сопоставление по коду поставщика
- Вендор ID* - Требуется ввести название поля связанного с внутренним артикулом товара (```codeAlpha, артикль```).
- Проверка Вендор ID - Здесь можно найти префикс поставщика по значению артикля. Если проверка прошла успешно, ```"Префикс"``` автоматически заполнится.
- Префикс - Префикс заданный при импорте нуменклатуры в учётной системе. 

#### Товар
- Основной каталог - Имя тега в котором хранится один товар. (например ```data```), Может отсутствовать.
- Название* - Имя тега хранящий название. (например ```name```).
- Полное Название - Имя тега хранящего полное название. (например ```longname```).
- Описание - Имя тега хранящего описание. (например ```description```).
- Вендор - Имя тега хранящий название вендора. (например ```vendor```).
- Фото - Имя тега хранящий ссылку на фото. (например ```picture```, ```pictures.picture```).
Если фото находится в другом аттрибуте то нужно указать путь то нужного аттрибута (например ```pictures.picture```). 
- Фото 360 - Имя тега хранящий ссылку на фото. (например ```photo360```, ```photos360.photo360```).
- Видео - Имя тега хранящий ссылку на видео. (например ```video```, ```videos.video```).
- Особенности - Имя тега хранящий список особенностей. (например ```features```, ```etim7.etim.features```).

#### Аттрибуты
- Ссылка на аттрибуты - Если аттрибуты для товаров находятся в другом файле то необходимо указать ссылку на этот файл.
- Каталог аттрибутов URL - Требуется указать входную точку внешнего файла аттрибутов. (например ```data```).
- Каталог аттрибутов - Требуется указать входную точку файла аттрибутов. (например ```param```).
- Название - Требуется указать имя аттрибута. (например ```name```).
- Единица измерения - Требуется указать единицу измерения. (например ```unit```).
- Тип - Требуется указать тип. (например ```type```).
- Значение - Требуется указать значение. (например ```value```).

#### Примеры
- Если нужная запись находится в другом в массиве то нужно указать путь. 

    Пример для сертификатов - ```certificate.name```
  ```json
    {
        "certificate": [
                {
                    "issued_by": "Роспотребнадзор",
                    "active_to": "20.03.2023",
                    "name": "Санитарно - эпидемиологическое заключение",
                    "url": "..."
                }
            ],
    }
  ```
 
- Если требуется взять массив значений и взять из этого массива конкретное значение.

    Пример для фото - ```ImgJpeg[*].uri```
  ```json
    {
        "ImgJpeg": [
			{
				"file": {
					"baseName": "PictureName.jpg",
					"name": "UsingName.jpg",
					"size": 620,
					"uri": "UsingName.jpg"
				}
			}
		]
    }
    ```
    | Синтаксис          | Описание                                                          |
    | :----------:       | -----------                                                       |
    | $                  | корневой объект/элемент                                           |
    | @                  | текущий объект/элемент                                            |
    |. или []            | дочерний оператор                                                 |
    | . .                | рекурсивный спуск                                                 |
    | *                  | подстановочный знак. Все объекты/элементы независимо от их имен.  |
    | []                 | оператор нижнего индекса                                          |
    | [,]                | допускает альтернативные имена или индексы массива в виде набора. | 
    | [начало:конец:шаг] | оператор среза массива.                                           |
    | ?()                | применяет выражение фильтра (скрипта).                            |
    | ()                 | выражение сценария, используя базовый механизм сценариев.         |
    
    
    
## Руководство для импорта файла типа «XML»
<a id="xml"></a>
Файл представляет собой структуру записей типа:
```<тег аттрибут="Значение аттрибута">Значение</param>```
Для начала импорта пользователь должен заполнить все необходимые поля. Обязательные поля помечены ```*```
#### Подключение
- Url - Требуется ввести ссылку на файл импорта либо указать API поставщика вместе с ключом (API Key) если принимает через Query параметр.
- Тип запроса - В выпадающем списке требуется выбрать тип запроса на сервер поставщика (В большинстве случаев GET).
- Тип файла - В выпадающем списке требуется выбрать тип файла для импорта.
- Кодировка файла - Если в файле для импорта указана другая кодировка (например windows 1251) пользователь должен указать её в поле.
- Стартовая страница - Поле для поставщиков у которых API позволяет получать список товаров постранично, нужно указать первую страницу с API поставщика.
- Кол-во записей на странице - Количество товаров выдаваемое поставщиком на одной странице API.
- Header запроса - Требуется ввести список параметров запроса.  (Например ```Authorization:Bearer Token```).
Структура: ```[{"HeaderName":"...","HeaderValue":"..."}, {...}]``` где ```...``` требуется указать Имя и Значение в соответствии с документацией поставщика.
- Body запроса - Тело запроса если используется ```POST``` запрос.
Структура: ```{"token":"..."}``` где ```...``` требуется указать API-Key в соответствии с документацией поставщика.
#### Сопоставление по коду поставщика
- Вендор ID* - Требуется ввести название поля связанного с внутренним артикулом товара (```codeAlpha, артикль```).
- Проверка Вендор ID - Здесь можно найти префикс поставщика по значению артикля. Если проверка прошла успешно, ```"Префикс"``` автоматически заполнится.
- Префикс - Префикс заданный при импорте нуменклатуры в учётной системе. 
#### Товар
- Основной каталог* - Имя тега в котором хранится один товар. (например ```offer```).
- Название* - Имя тега хранящий название. (например ```name```).
- Полное Название - Имя тега хранящего полное название. (например ```longname```).
- Описание - Имя тега хранящего описание. (например ```description```).
- Вендор - Имя тега хранящий название вендора. (например ```vendor```).
- Фото - Имя тега хранящий ссылку на фото. (например ```picture```, ```pictures/picture```).
Если фото находится в другом аттрибуте то нужно указать путь то нужного аттрибута (например ```pictures/picture```). 
- Фото 360 - Имя тега хранящий ссылку на фото. (например ```photo360```, ```photos360/photo360```).
- Видео - Имя тега хранящий ссылку на видео. (например ```video```, ```videos/video```).
- Особенности - Имя тега хранящий список особенностей. (например ```features```, ```etim7/etim/features```).
#### Аттрибуты
- Ссылка на аттрибуты - Если аттрибуты для товаров находятся в другом файле то необходимо указать ссылку на этот файл.
- Каталог аттрибутов URL - Требуется указать входную точку внешнего файла аттрибутов. (например ```data```).
- Каталог аттрибутов - Требуется указать входную точку файла аттрибутов. (например ```param```).
- Название - Требуется указать имя аттрибута. (например ```name```). В случае когда название лежит внутри аттрибута например ```<param name="Цвет">Красный</param>``` нужно написать следующее - ```@name```
- Единица измерения - Требуется указать единицу измерения. (например ```unit```, ```@unit```).
- Тип - Требуется указать тип. (например ```type```, ```@type```).
- Значение - Требуется указать значение. (например ```value```, ```param```).
#### Примеры
- Если нужный тег находится в другом теге то нужно указать путь. 
    Пример для фото - ```pictures/picture```
  ```xml
    <pictures>
		<picture>https://...</picture>
		<picture>https://...</picture>
		<picture>https://...</picture>
	</pictures>
  ```
    Пример для аттрибутов - ```params/param```
  ```xml
    <params>
		<param name="...">...</param>
		<param name="...">...</param>
		<param name="...">...</param>
	</params>
    ```
- Если нужный тег находится в другом теге и его нужно вытащить.

    Пример для Вендор ID - ```param[@name='Код товара']```
  ```xml
    <param name="Код товара">...</param>
  ```
